#!/bin/sh

# Updates the current wm theme and makes it persistent
# Available values are located in $HOME/.config/xresources/colors
# Run with `--prompt` to execute a dmenu-style prompt to choose a colorscheme

COLOR=""

if [ "$1" = "--prompt" ]; then
    colors=$(find $HOME/.config/xresources/colors -type f | sed 's/.*\///')
    COLOR="$(echo "$colors" | rofi -dmenu -width 350 -lines 6)"
else
    COLOR="$1"
fi

if [ -z "$COLOR" ]; then
    exit 0
fi

echo "$COLOR" > ~/.theme
herbstclient reload

# Reload the terminal color palette
sleep 2
background="$(xrdb -query | awk '/*background:/{print $2}')" 
color0="$(xrdb -query | awk '/*color0:/{print $2}')"

# works when background is equal to color0 due to inner padding
if [ "$background" = "$color0" ]; then
    killall urxvt -SIGHUP
    sleep .5
    killall urxvt -SIGHUP
else
    notify-send "switch-colors" "\nfailed to update palette"
fi

# Notify completion
notify-send "switch-colors" "\n$COLOR"
